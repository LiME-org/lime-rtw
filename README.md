# LiME

The Linux Model Extractor (aka LiME) observes and describes the timing behavior
of real-time threads.

The crate is named `lime-rtw` to avoid name clashes with existing crates and
respect rust naming conventions.

## Getting started

The tracing infrastructure is based on eBPF. Therefore a few dependencies are
required to compile the project.

On Ubuntu, you can install these dependencies with these commands:

```shell
apt-get update
apt-get install -y libbpf-dev libelf-dev zlib1g-dev pkg-config clang protobuf-compiler
```

### Kernel Requirements

LiME has been tested and is supported on Linux kernel versions from 5.15 to 6.12. Using LiME with kernel versions outside this range may result in unexpected behavior.

The tool requires a Linux kernel with eBPF features enabled. Additionally, the kernel must be compiled with `CONFIG_DEBUG_INFO_BTF=y` as LiME utilizes eBPF's CO-RE (Compile Once - Run Everywhere) feature. Without this configuration, the eBPF programs will fail to load.

## Building and running the tool

The tool is built like any rust project with `cargo build`.

To run the tool use the following:

```shell
sudo target/debug/lime-rtw
```

Root privileges are required to load eBPF programs, therefore `cargo run` cannot
be used.

## Offline Mode - Recording traces

Traces can be recorded and stored in the JSON format with the `trace` subcommand.

```shell
sudo target/debug/lime-rtw trace
```

If you want to trace only one specific program, `trace` can be followed by a command line.

For instance to trace `top` scheduled with the `SCHED_FIFO` policy, one can run:

```shell
sudo target/debug lime trace -- chrt -f 99 htop
```

## Online Mode - Model extraction

To launch the tracer and extract models, use the `extract` command.

```shell
sudo target/debug/lime-rtw extract
```

You can also extract models from JSON traces generated by offline tracing mode with the `--from` option.

```shell
sudo target/debug/lime-rtw extract --from <path_to_trace>
```

Succesfully extracted models will be recorded in `<task-identifier>.models.json`. A task-identifier is `<pid>-<version>`, where the same process with different scheduling policy and priority changed on the fly will be considered as different versions.

The output directory can be specified with the `-o` options. If no path is specified
a directory will be created. If models are extracted from a recorded trace, the output
directory can be set to the trace folder with the `--inplace` flag.

```shell
sudo target/debug/lime-rtw extract --from <path_to_trace> --inplace
```

